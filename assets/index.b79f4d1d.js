var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,n=(t,a,r)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r,s=(e,t)=>{for(var a in t||(t={}))i.call(t,a)&&n(e,a,t[a]);if(r)for(var a of r(t))l.call(t,a)&&n(e,a,t[a]);return e},m=(e,r)=>t(e,a(r));import{c as o,a as _,b as c,d,e as h,u as p,j as u,f as g,r as b,_ as f,F,g as y,h as N,R as v,i as k,P as x}from"./vendor.4289e754.js";const I=(e,t)=>Math.floor(Math.random()*(t-e)+e),C=async(e,t)=>new Promise(((a,r)=>{setTimeout((()=>{e&&a(e()),t&&r(t())}),I(300,1e3))})),S=()=>{const e={},t=["url","variable","test","date","title","buddy","hey","xsolla"],a=I(1,t.length),r=()=>{Object.keys(e).length<a&&(e[t[I(0,t.length)]]={structure:"scalar",type:"string"},r())};return r(),e},w=async e=>C(S),P=()=>({id:I(1,1e4)}),T=async e=>C(P),O=async e=>C(P),A=async e=>C(P),V=o("MainForm/postData",(async e=>{const t=await w(e);return console.groupCollapsed("Запрос /data"),console.log("params:",JSON.stringify(e)),console.log("resoinse:",JSON.stringify(t)),console.groupEnd(),t})),j=o("MainForm/createLetter",(async e=>{const t=await T(e);return console.groupCollapsed("Запрос /createLetter"),console.log("params:",JSON.stringify(e)),console.log("resoinse:",JSON.stringify(t)),console.groupEnd(),t})),D=o("MainForm/createChatMessage",(async e=>{const t=await O(e);return console.groupCollapsed("Запрос /createChatMessage"),console.log("params:",JSON.stringify(e)),console.log("resoinse:",JSON.stringify(t)),console.groupEnd(),t})),M=o("MainForm/createTicket",(async e=>{const t=await A(e);return console.groupCollapsed("Запрос /createTicket"),console.log("params:",JSON.stringify(e)),console.log("resoinse:",JSON.stringify(t)),console.groupEnd(),t}));const q=d({reducer:c({mainForm:_({name:"MainForm",initialState:{Variables:null,CreationPayload:null},reducers:{},extraReducers:e=>{e.addCase(V.fulfilled,((e,t)=>{e.Variables=t.payload})),e.addCase(j.fulfilled,((e,t)=>{e.CreationPayload={type:"letter",id:t.payload.id,timestamp:(new Date).toDateString()}})),e.addCase(D.fulfilled,((e,t)=>{e.CreationPayload={type:"chat_message",id:t.payload.id,timestamp:(new Date).toDateString()}})),e.addCase(M.fulfilled,((e,t)=>{e.CreationPayload={type:"ticket",id:t.payload.id,timestamp:(new Date).toDateString()}}))}}).reducer}),devTools:!1}),E=h((e=>e.mainForm.Variables),(e=>e)),H=h(E,(e=>Object.keys(null!=e?e:{}))),W=h((e=>e.mainForm.CreationPayload),(e=>e)),K=e=>{const{handleDataPost:t}=e,a=p((e=>{const a=e.target;a.value&&a.checkValidity()?t(a.value):a.reportValidity()}),250);return u("fieldset",{className:"mainForm__fieldset",children:[g("div",{className:"mainForm__fieldset__legend",children:"Data"}),g("div",{className:"mainForm__fieldset__inputs",children:u("div",{className:"mainForm__formItem",children:[g("label",{className:"mainForm__formItem__label",htmlFor:"dwh_link",children:"DWH Link"}),g("input",{className:"mainForm__formItem__input",id:"dwh_link",name:"dwh_link",type:"url",onInput:a,placeholder:"https://service.xsolla.com",required:!0})]})}),g("div",{className:"mainForm__fieldset__extra"})]})},$=e=>{const t=b.exports.useCallback((e=>{const t=e.split(":");return-1*(60*Number(t[0])+Number(t[1]))}),[]);return u("fieldset",{className:"mainForm__fieldset",children:[g("div",{className:"mainForm__fieldset__legend",children:"Trigger"}),u("div",{className:"mainForm__fieldset__inputs mainForm__fieldset__inputs--two",children:[u("div",{className:"mainForm__formItem mainForm__formItem__noTopMargin",children:[g("label",{className:"mainForm__formItem__label",htmlFor:"cron_exp",children:"CRON expression"}),g("input",{className:"mainForm__formItem__input",id:"cron_exp",name:"cron_exp",type:"text",placeholder:"0 */15 * ? * *",required:!0})]}),u("div",{className:"mainForm__formItem mainForm__formItem__noTopMargin",children:[g("label",{className:"mainForm__formItem__label",htmlFor:"timezone",children:"Time zone"}),g("select",{className:"mainForm__formItem__input",id:"timezone",name:"timezone",required:!0,children:f.map((e=>g("option",{value:t(e.utc),children:e.label},e.tzCode)))})]})]}),g("div",{className:"mainForm__fieldset__extra"})]})},J=e=>{const{inputProps:t,inputClassName:a}=e,{inputOnChange:r}=e,{hightlightArray:i}=e,[l,n]=b.exports.useState(""),m=b.exports.useCallback((e=>{r&&r(e);let t=e.currentTarget.value;i.forEach((e=>{t=t.replace(/\n$/g,"\n\n"),t=t.replaceAll(`{{ ${e} }}`,`<mark>{{ ${e} }}</mark>`)})),n(t)}),[r,i]);return u("div",{className:"mainForm__inputWithHightlight mainForm__inputWithHightlight--textInput",children:[g("div",{className:"mainForm__inputWithHightlight__highlights",children:g("div",{className:"mainForm__inputWithHightlight__highlights__textBox",dangerouslySetInnerHTML:{__html:l}})}),g("input",s({className:`mainForm__inputWithHightlight__input ${a}`,onChange:m,onScroll:e=>console.log(e.currentTarget.scrollWidth)},t))]})},L=e=>{const{textareaProps:t,textareaClassName:a}=e,{textareaOnScroll:r,textareaOnChange:i}=e,{hightlightArray:l}=e,[n,m]=b.exports.useState(""),o=b.exports.useRef(document.createElement("div")),_=b.exports.useCallback((e=>{i&&i(e);let t=e.currentTarget.value;l.forEach((e=>{t=t.replace(/\n$/g,"\n\n"),t=t.replaceAll(`{{ ${e} }}`,`<mark>{{ ${e} }}</mark>`)})),m(t)}),[i,l]),c=b.exports.useCallback((e=>{r&&r(e);const t=e.currentTarget.scrollTop;o.current.scrollTop=t}),[r]);return u("div",{className:"mainForm__inputWithHightlight mainForm__inputWithHightlight--textarea",children:[g("div",{ref:o,className:"mainForm__inputWithHightlight__highlights",children:g("div",{className:"mainForm__inputWithHightlight__highlights__textBox",dangerouslySetInnerHTML:{__html:n}})}),g("textarea",s({className:`mainForm__inputWithHightlight__input ${a}`,onChange:_,onScroll:c},t))]})},z=e=>{const{VariablesKeys:t}=e;return u(F,{children:[u("div",{className:"mainForm__formItem",children:[g("label",{className:"mainForm__formItem__label",htmlFor:"letter_from",children:"From"}),g(J,{inputClassName:"mainForm__formItem__input",inputProps:{id:"letter_from",name:"letter_from",required:!0},hightlightArray:t})]}),u("div",{className:"mainForm__formItem",children:[g("label",{className:"mainForm__formItem__label",htmlFor:"letter_to",children:"To"}),g(J,{inputClassName:"mainForm__formItem__input",inputProps:{id:"letter_to",name:"letter_to",required:!0},hightlightArray:t})]}),u("div",{className:"mainForm__formItem",children:[g("label",{className:"mainForm__formItem__label",htmlFor:"letter_subject",children:"Subject"}),g(J,{inputClassName:"mainForm__formItem__input",inputProps:{id:"letter_subject",name:"letter_subject",required:!0},hightlightArray:t})]}),u("div",{className:"mainForm__formItem",children:[g("label",{className:"mainForm__formItem__label",htmlFor:"letter_text",children:"Text"}),g(L,{textareaClassName:"mainForm__formItem__input mainForm__formItem__input--textarea",textareaProps:{id:"letter_text",name:"letter_text",required:!0},hightlightArray:t})]})]})},R=e=>{const{VariablesKeys:t}=e;return u(F,{children:[u("div",{className:"mainForm__formItem",children:[g("label",{className:"mainForm__formItem__label",htmlFor:"chat_webhook_url",children:"Webhook URL"}),g(J,{inputClassName:"mainForm__formItem__input",inputProps:{id:"chat_webhook_url",name:"chat_webhook_url",required:!0},hightlightArray:t})]}),u("div",{className:"mainForm__formItem",children:[g("label",{className:"mainForm__formItem__label",htmlFor:"chat_text",children:"Text"}),g(L,{textareaClassName:"mainForm__formItem__input mainForm__formItem__input--textarea",textareaProps:{id:"chat_text",name:"chat_text",required:!0},hightlightArray:t})]})]})},B=e=>{const{VariablesKeys:t}=e;return u(F,{children:[u("div",{className:"mainForm__formItem",children:[g("label",{className:"mainForm__formItem__label",htmlFor:"ticket_summary",children:"Summary"}),g(J,{inputClassName:"mainForm__formItem__input",inputProps:{id:"ticket_summary",name:"ticket_summary",required:!0},hightlightArray:t})]}),u("div",{className:"mainForm__formItem",children:[g("label",{className:"mainForm__formItem__label",htmlFor:"ticket_description",children:"Description"}),g(J,{inputClassName:"mainForm__formItem__input",inputProps:{id:"ticket_description",name:"ticket_description",required:!0},hightlightArray:t})]}),u("div",{className:"mainForm__formItem",children:[g("label",{className:"mainForm__formItem__label",htmlFor:"ticket_assignee",children:"Assignee"}),g(J,{inputClassName:"mainForm__formItem__input",inputProps:{id:"ticket_assignee",name:"ticket_assignee",required:!0},hightlightArray:t})]}),u("div",{className:"mainForm__formItem",children:[g("label",{className:"mainForm__formItem__label",htmlFor:"ticket_reporter",children:"Reporter"}),g(J,{inputClassName:"mainForm__formItem__input",inputProps:{id:"ticket_reporter",name:"ticket_reporter",required:!0},hightlightArray:t})]})]})},U=e=>{const{Variables:t,VariablesKeys:a}=e,{SelectedActivityType:r,selectedActivityTypeChange:i}=e;return u("fieldset",{className:"mainForm__fieldset",children:[g("div",{className:"mainForm__fieldset__legend",children:"Activity"}),u("div",{className:"mainForm__fieldset__inputs",children:[u("div",{className:"mainForm__formItem",children:[g("label",{className:"mainForm__formItem__label",htmlFor:"activity_type",children:"Type"}),u("select",{className:"mainForm__formItem__input",id:"activity_type",name:"activity_type",value:r,onChange:e=>i(e.currentTarget.value),required:!0,children:[g("option",{disabled:!0,hidden:!0,value:"none"}),g("option",{value:"letter",children:"Letter"}),g("option",{value:"chat_message",children:"Chat Message"}),g("option",{value:"ticket",children:"Ticket"})]})]}),"letter"===r?g(z,{VariablesKeys:a}):null,"chat_message"===r?g(R,{VariablesKeys:a}):null,"ticket"===r?g(B,{VariablesKeys:a}):null]}),g("section",{className:"mainForm__fieldset__extra mainForm__variables",children:t?u(F,{children:[g("h4",{className:"mainForm__variables__title",children:"Variables"}),g("ul",{className:"mainForm__variables__list",children:Object.entries(t).map((e=>g("li",{className:"mainForm__variables__listItem",children:g("button",{className:"mainForm__variables__button",children:e[0]})},e[0])))})]}):null})]})};const G=e=>{const{Variables:t,VariablesKeys:a}=e,{handleDataPost:r}=e,{handleFormEntriesSubmit:i}=e,[l,n]=b.exports.useState("none"),s=b.exports.useCallback((e=>{e.preventDefault();const t=new FormData(e.target),a=Object.fromEntries(t);if("none"===a.activity_type)return alert("No activity type selected");i(a)}),[i]),m=b.exports.useCallback((e=>{n(e)}),[]);return u("form",{className:"mainForm",onSubmit:s,children:[g(K,{handleDataPost:r}),g("hr",{className:"mainForm__separator"}),g($,{}),g("hr",{className:"mainForm__separator"}),g(U,{Variables:t,VariablesKeys:a,SelectedActivityType:l,selectedActivityTypeChange:m}),"none"!==l?u("div",{className:"mainForm__buttons",children:[g("div",{children:g("button",{type:"submit",children:"Create"})}),g("div",{children:g("button",{type:"reset",children:"Reset"})})]}):null]})},Q=()=>{const e=y(E),t=y(H),a=y(W),r=N();b.exports.useEffect((()=>{if(a){let e="";switch(a.type){case"letter":e="Letter";break;case"chat_message":e="Chat Message";break;case"ticket":e="Ticket"}alert(`Activity "${e}" has been successfully created (ID: ${a.id})`)}}),[a]);const i=b.exports.useCallback((e=>{r(V({dwh_link:e}))}),[r]),l=b.exports.useCallback((e=>{const t={dwh_link:e.dwh_link,cron_exp:e.cron_exp,timezone:e.timezone};switch(e.activity_type){case"letter":r(j(m(s({},t),{data:{letter_from:e.letter_from,letter_to:e.letter_to,letter_subject:e.letter_subject,letter_text:e.letter_text}})));break;case"chat_message":r(D(m(s({},t),{data:{chat_webhook_url:e.chat_webhook_url,chat_text:e.chat_text}})));break;case"ticket":r(M(m(s({},t),{data:{ticket_summary:e.ticket_summary,ticket_description:e.ticket_description,ticket_assignee:e.ticket_assignee,ticket_reporter:e.ticket_reporter}})))}}),[r]);return g(G,{Variables:e,VariablesKeys:t,handleDataPost:i,handleFormEntriesSubmit:l})};const X=()=>u("div",{className:"app",children:[g("header",{className:"app__header",children:g("h1",{children:"¯\\_(ツ)_/¯"})}),u("main",{className:"app__content",children:[g("div",{className:"app__content__wrapper",children:g(Q,{})}),u("div",{className:"app__content__link",children:["github:"," ",g("a",{href:"https://github.com/e965/xsolla-test-task",target:"_blank",children:"e965/xsolla-test-task"})]})]})]});v.render(g(k.StrictMode,{children:g(x,{store:q,children:g(X,{})})}),document.getElementById("root"));
