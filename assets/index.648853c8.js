var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,n=(t,r,a)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a,s=(e,t)=>{for(var r in t||(t={}))i.call(t,r)&&n(e,r,t[r]);if(a)for(var r of a(t))l.call(t,r)&&n(e,r,t[r]);return e},o=(e,a)=>t(e,r(a));import{c as m,a as c,b as _,d,e as u,r as h,j as p,u as g,f,_ as b,F as y,g as F,h as v,R as N,i as x,P as k}from"./vendor.6197a69e.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const C=(e,t)=>Math.floor(Math.random()*(t-e)+e),I=async(e,t)=>new Promise(((r,a)=>{setTimeout((()=>{e&&r(e()),t&&a(t())}),C(300,1e3))})),S=()=>{const e={},t=["url","variable","test","date","title","buddy","hey","xsolla"],r=C(1,t.length),a=()=>{Object.keys(e).length<r&&(e[t[C(0,t.length)]]={structure:"scalar",type:"string"},a())};return a(),e},E=async e=>I(S),P=()=>({id:C(1,1e4)}),w=async e=>I(P),T=async e=>I(P),O=async e=>I(P),A=m("MainForm/postData",(async e=>{const t=await E(e);return console.groupCollapsed("Запрос /data"),console.log("params:",JSON.stringify(e)),console.log("resoinse:",JSON.stringify(t)),console.groupEnd(),t})),D=m("MainForm/createLetter",(async e=>{const t=await w(e);return console.groupCollapsed("Запрос /createLetter"),console.log("params:",JSON.stringify(e)),console.log("resoinse:",JSON.stringify(t)),console.groupEnd(),t})),V=m("MainForm/createChatMessage",(async e=>{const t=await T(e);return console.groupCollapsed("Запрос /createChatMessage"),console.log("params:",JSON.stringify(e)),console.log("resoinse:",JSON.stringify(t)),console.groupEnd(),t})),M=m("MainForm/createTicket",(async e=>{const t=await O(e);return console.groupCollapsed("Запрос /createTicket"),console.log("params:",JSON.stringify(e)),console.log("resoinse:",JSON.stringify(t)),console.groupEnd(),t}));const j=d({reducer:_({mainForm:c({name:"MainForm",initialState:{Variables:null,CreationPayload:null},reducers:{},extraReducers:e=>{e.addCase(A.fulfilled,((e,t)=>{e.Variables=t.payload})),e.addCase(D.fulfilled,((e,t)=>{e.CreationPayload={type:"letter",id:t.payload.id,timestamp:(new Date).toDateString()}})),e.addCase(V.fulfilled,((e,t)=>{e.CreationPayload={type:"chat_message",id:t.payload.id,timestamp:(new Date).toDateString()}})),e.addCase(M.fulfilled,((e,t)=>{e.CreationPayload={type:"ticket",id:t.payload.id,timestamp:(new Date).toDateString()}}))}}).reducer}),devTools:!1}),L=u((e=>e.mainForm.Variables),(e=>e)),q=u(L,(e=>Object.keys(null!=e?e:{}))),H=u((e=>e.mainForm.CreationPayload),(e=>e)),R=h.exports.createContext([void 0,()=>{},void 0,()=>{}]),W=({children:e})=>{const[t,r]=h.exports.useState(),[a,i]=h.exports.useState(),l=h.exports.useCallback((e=>{r(e),i(void 0)}),[]),n=h.exports.useCallback((e=>{i(e),r(void 0)}),[]);return p(R.Provider,{value:[t,l,a,n],children:e})},K=e=>{const{handleDataPost:t}=e,{handleDataFieldsSetted:r}=e,a=g((e=>{const a=e.target;a.value&&a.checkValidity()?(t(a.value),r()):a.reportValidity()}),250);return f("fieldset",{className:"mainForm__fieldset",children:[p("div",{className:"mainForm__fieldset__legend",children:"Data"}),p("div",{className:"mainForm__fieldset__inputs",children:f("div",{className:"mainForm__formItem",children:[p("label",{className:"mainForm__formItem__label",htmlFor:"dwh_link",children:"DWH Link"}),p("input",{className:"mainForm__formItem__input",id:"dwh_link",name:"dwh_link",type:"url",onInput:a,placeholder:"https://service.xsolla.com",required:!0})]})}),p("div",{className:"mainForm__fieldset__extra"})]})},$=e=>{const{IsTriggerUnlocked:t}=e,{handleTriggerFieldsSetted:r}=e,a=h.exports.useCallback((e=>{const t=e.split(":");return-1*(60*Number(t[0])+Number(t[1]))}),[]),i=h.exports.useCallback((()=>{r()}),[]);return f("fieldset",{className:"mainForm__fieldset",children:[p("div",{className:"mainForm__fieldset__legend",children:"Trigger"}),f("div",{className:"mainForm__fieldset__inputs mainForm__fieldset__inputs--two",children:[f("div",{className:"mainForm__formItem mainForm__formItem__noTopMargin",children:[p("label",{className:"mainForm__formItem__label",htmlFor:"cron_exp",children:"CRON expression"}),p("input",{className:"mainForm__formItem__input",id:"cron_exp",name:"cron_exp",type:"text",placeholder:"0 */15 * ? * *",disabled:!t,onChange:i,required:!0})]}),f("div",{className:"mainForm__formItem mainForm__formItem__noTopMargin",children:[p("label",{className:"mainForm__formItem__label",htmlFor:"timezone",children:"Time zone"}),p("select",{className:"mainForm__formItem__input",id:"timezone",name:"timezone",disabled:!t,required:!0,children:b.map((e=>p("option",{value:a(e.utc),children:e.label},e.tzCode)))})]})]}),p("div",{className:"mainForm__fieldset__extra"})]})},J=e=>{const{inputProps:t,inputClassName:r}=e,{inputOnChange:a,inputOnFocus:i}=e,{hightlightArray:l}=e,[n,o]=h.exports.useState(""),[m,c]=h.exports.useContext(R),[_,d]=h.exports.useState(!1),u=h.exports.useRef(document.createElement("input"));h.exports.useEffect((()=>{var e,t;d((null==(e=null==m?void 0:m.current)?void 0:e.id)===(null==(t=null==u?void 0:u.current)?void 0:t.id))}),[m]),h.exports.useEffect((()=>{const e=e=>{const t=e.target;g(t.value)};_?u.current.addEventListener("change",e):u.current.removeEventListener("change",e)}),[_]);const g=h.exports.useCallback((e=>{let t=e;l.forEach((e=>{t=t.replace(/\n$/g,"\n\n"),t=t.replaceAll(`{{ ${e} }}`,`<mark>{{ ${e} }}</mark>`)})),o(t)}),[l]),b=h.exports.useCallback((e=>{a&&a(e),g(e.target.value)}),[a,g]),y=h.exports.useCallback((e=>{i&&i(e),c(u)}),[i,c]);return f("div",{className:"mainForm__inputWithHightlight mainForm__inputWithHightlight--textInput",children:[p("div",{className:"mainForm__inputWithHightlight__highlights",children:p("div",{className:"mainForm__inputWithHightlight__highlights__textBox",dangerouslySetInnerHTML:{__html:n}})}),p("input",s({ref:u,className:`mainForm__inputWithHightlight__input ${r}`,onChange:b,onFocus:y},t))]})},z=e=>{const{textareaProps:t,textareaClassName:r}=e,{textareaOnScroll:a,textareaOnChange:i,textareaOnFocus:l}=e,{hightlightArray:n}=e,[o,m]=h.exports.useState(""),[,,c,_]=h.exports.useContext(R),[d,u]=h.exports.useState(!1),g=h.exports.useRef(document.createElement("textarea")),b=h.exports.useRef(document.createElement("div"));h.exports.useEffect((()=>{var e,t;u((null==(e=null==c?void 0:c.current)?void 0:e.id)===(null==(t=null==g?void 0:g.current)?void 0:t.id))}),[c]),h.exports.useEffect((()=>()=>{_(void 0)}),[]),h.exports.useEffect((()=>{const e=e=>{const t=e.target;y(t.value)};d?g.current.addEventListener("change",e):g.current.removeEventListener("change",e)}),[d]);const y=h.exports.useCallback((e=>{let t=e;n.forEach((e=>{t=t.replace(/\n$/g,"\n\n"),t=t.replaceAll(`{{ ${e} }}`,`<mark>{{ ${e} }}</mark>`)})),m(t)}),[n]),F=h.exports.useCallback((e=>{i&&i(e),y(e.target.value)}),[i,y]),v=h.exports.useCallback((e=>{a&&a(e);const t=e.currentTarget.scrollTop;b.current.scrollTop=t}),[a]),N=h.exports.useCallback((e=>{l&&l(e),_(g)}),[l,_]);return f("div",{className:"mainForm__inputWithHightlight mainForm__inputWithHightlight--textarea",children:[p("div",{ref:b,className:"mainForm__inputWithHightlight__highlights",children:p("div",{className:"mainForm__inputWithHightlight__highlights__textBox",dangerouslySetInnerHTML:{__html:o}})}),p("textarea",s({ref:g,className:`mainForm__inputWithHightlight__input ${r}`,onChange:F,onScroll:v,onFocus:N},t))]})},U=e=>{const{VariablesKeys:t}=e;return f(y,{children:[f("div",{className:"mainForm__formItem",children:[p("label",{className:"mainForm__formItem__label",htmlFor:"letter_from",children:"From"}),p(J,{inputClassName:"mainForm__formItem__input",inputProps:{id:"letter_from",name:"letter_from",required:!0},hightlightArray:t})]}),f("div",{className:"mainForm__formItem",children:[p("label",{className:"mainForm__formItem__label",htmlFor:"letter_to",children:"To"}),p(J,{inputClassName:"mainForm__formItem__input",inputProps:{id:"letter_to",name:"letter_to",required:!0},hightlightArray:t})]}),f("div",{className:"mainForm__formItem",children:[p("label",{className:"mainForm__formItem__label",htmlFor:"letter_subject",children:"Subject"}),p(J,{inputClassName:"mainForm__formItem__input",inputProps:{id:"letter_subject",name:"letter_subject",required:!0},hightlightArray:t})]}),f("div",{className:"mainForm__formItem",children:[p("label",{className:"mainForm__formItem__label",htmlFor:"letter_text",children:"Text"}),p(z,{textareaClassName:"mainForm__formItem__input mainForm__formItem__input--textarea",textareaProps:{id:"letter_text",name:"letter_text",required:!0},hightlightArray:t})]})]})},B=e=>{const{VariablesKeys:t}=e;return f(y,{children:[f("div",{className:"mainForm__formItem",children:[p("label",{className:"mainForm__formItem__label",htmlFor:"chat_webhook_url",children:"Webhook URL"}),p(J,{inputClassName:"mainForm__formItem__input",inputProps:{id:"chat_webhook_url",name:"chat_webhook_url",required:!0},hightlightArray:t})]}),f("div",{className:"mainForm__formItem",children:[p("label",{className:"mainForm__formItem__label",htmlFor:"chat_text",children:"Text"}),p(z,{textareaClassName:"mainForm__formItem__input mainForm__formItem__input--textarea",textareaProps:{id:"chat_text",name:"chat_text",required:!0},hightlightArray:t})]})]})},G=e=>{const{VariablesKeys:t}=e;return f(y,{children:[f("div",{className:"mainForm__formItem",children:[p("label",{className:"mainForm__formItem__label",htmlFor:"ticket_summary",children:"Summary"}),p(J,{inputClassName:"mainForm__formItem__input",inputProps:{id:"ticket_summary",name:"ticket_summary",required:!0},hightlightArray:t})]}),f("div",{className:"mainForm__formItem",children:[p("label",{className:"mainForm__formItem__label",htmlFor:"ticket_description",children:"Description"}),p(J,{inputClassName:"mainForm__formItem__input",inputProps:{id:"ticket_description",name:"ticket_description",required:!0},hightlightArray:t})]}),f("div",{className:"mainForm__formItem",children:[p("label",{className:"mainForm__formItem__label",htmlFor:"ticket_assignee",children:"Assignee"}),p(J,{inputClassName:"mainForm__formItem__input",inputProps:{id:"ticket_assignee",name:"ticket_assignee",required:!0},hightlightArray:t})]}),f("div",{className:"mainForm__formItem",children:[p("label",{className:"mainForm__formItem__label",htmlFor:"ticket_reporter",children:"Reporter"}),p(J,{inputClassName:"mainForm__formItem__input",inputProps:{id:"ticket_reporter",name:"ticket_reporter",required:!0},hightlightArray:t})]})]})},Q=e=>{const{Variables:t,VariablesKeys:r}=e,{IsActivityUnlocked:a}=e,{SelectedActivityType:i,selectedActivityTypeChange:l}=e,[n,,s]=h.exports.useContext(R),o=h.exports.useCallback((e=>{const t=document.createEvent("HTMLEvents");t.initEvent("change",!1,!0);const r=(e,t,r)=>e.substring(0,t)+`{{ ${r} }}`+e.substring(t,e.length),a=e.length+"{{  }}".length;if(n){const i=n.current,l=Number(i.selectionEnd),s=l+a;n.current.focus(),n.current.value=r(i.value,l,e),n.current.setSelectionRange(s,s),n.current.dispatchEvent(t)}if(s){const i=s.current,l=Number(i.selectionEnd),n=l+a;s.current.focus(),s.current.value=r(i.value,l,e),s.current.setSelectionRange(n,n),s.current.dispatchEvent(t)}}),[n,s]),m=h.exports.useMemo((()=>!!n||!!s),[n,s]);return f("fieldset",{className:"mainForm__fieldset",children:[p("div",{className:"mainForm__fieldset__legend",children:"Activity"}),f("div",{className:"mainForm__fieldset__inputs",children:[f("div",{className:"mainForm__formItem",children:[p("label",{className:"mainForm__formItem__label",htmlFor:"activity_type",children:"Type"}),f("select",{className:"mainForm__formItem__input",id:"activity_type",name:"activity_type",value:i,onChange:e=>l(e.currentTarget.value),disabled:!a,required:!0,children:[p("option",{disabled:!0,hidden:!0,value:"none"}),p("option",{value:"letter",children:"Letter"}),p("option",{value:"chat_message",children:"Chat Message"}),p("option",{value:"ticket",children:"Ticket"})]})]}),"letter"===i?p(U,{VariablesKeys:r}):null,"chat_message"===i?p(B,{VariablesKeys:r}):null,"ticket"===i?p(G,{VariablesKeys:r}):null]}),p("section",{className:"mainForm__fieldset__extra mainForm__variables",children:t?f(y,{children:[p("h4",{className:"mainForm__variables__title",children:"Variables"}),p("ul",{className:"mainForm__variables__list",children:Object.entries(t).map((e=>p("li",{className:"mainForm__variables__listItem",children:p("button",{type:"button",className:"mainForm__variables__button",onClick:t=>{t.preventDefault(),o(e[0])},disabled:!m,children:e[0]})},e[0])))})]}):null})]})};const X=e=>{const{Variables:t,VariablesKeys:r}=e,{handleDataPost:a}=e,{handleFormEntriesSubmit:i}=e,[l,n]=h.exports.useState(!1),[s,o]=h.exports.useState(!1),[m,c]=h.exports.useState("none"),_=h.exports.useCallback((e=>{e.preventDefault();const t=new FormData(e.target),r=Object.fromEntries(t);if("none"===r.activity_type)return alert("No activity type selected");i(r)}),[i]),d=h.exports.useCallback((()=>{n(!1),o(!1),c("none")}),[]),u=h.exports.useCallback((e=>{c(e)}),[]),g=h.exports.useCallback((()=>{n(!0)}),[]),b=h.exports.useCallback((()=>{o(!0)}),[]);return f("form",{className:"mainForm",onSubmit:_,onReset:d,children:[p(K,{handleDataPost:a,handleDataFieldsSetted:g}),p("hr",{className:"mainForm__separator"}),p($,{IsTriggerUnlocked:l,handleTriggerFieldsSetted:b}),p("hr",{className:"mainForm__separator"}),p(W,{children:p(Q,{Variables:t,VariablesKeys:r,IsActivityUnlocked:s,SelectedActivityType:m,selectedActivityTypeChange:u})}),"none"!==m&&s?f("div",{className:"mainForm__buttons",children:[p("div",{children:p("button",{type:"submit",children:"Create"})}),p("div",{children:p("button",{type:"reset",children:"Reset"})})]}):null]})},Y=()=>{const e=F(L),t=F(q),r=F(H),a=v();h.exports.useEffect((()=>{if(r){let e="";switch(r.type){case"letter":e="Letter";break;case"chat_message":e="Chat Message";break;case"ticket":e="Ticket"}alert(`Activity "${e}" has been successfully created (ID: ${r.id})`)}}),[r]);const i=h.exports.useCallback((e=>{a(A({dwh_link:e}))}),[a]),l=h.exports.useCallback((e=>{const t={dwh_link:e.dwh_link,cron_exp:e.cron_exp,timezone:e.timezone};switch(e.activity_type){case"letter":a(D(o(s({},t),{data:{letter_from:e.letter_from,letter_to:e.letter_to,letter_subject:e.letter_subject,letter_text:e.letter_text}})));break;case"chat_message":a(V(o(s({},t),{data:{chat_webhook_url:e.chat_webhook_url,chat_text:e.chat_text}})));break;case"ticket":a(M(o(s({},t),{data:{ticket_summary:e.ticket_summary,ticket_description:e.ticket_description,ticket_assignee:e.ticket_assignee,ticket_reporter:e.ticket_reporter}})))}}),[a]);return p(X,{Variables:e,VariablesKeys:t,handleDataPost:i,handleFormEntriesSubmit:l})};const Z=()=>f("div",{className:"app",children:[p("header",{className:"app__header",children:p("h1",{children:"¯\\_(ツ)_/¯"})}),f("main",{className:"app__content",children:[p("div",{className:"app__content__wrapper",children:p(Y,{})}),f("div",{className:"app__content__link",children:["github:"," ",p("a",{href:"https://github.com/e965/xsolla-test-task",target:"_blank",children:"e965/xsolla-test-task"})]})]})]});N.render(p(x.StrictMode,{children:p(k,{store:j,children:p(Z,{})})}),document.getElementById("root"));
