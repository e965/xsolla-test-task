var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,s=(t,a,r)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r,n=(e,t)=>{for(var a in t||(t={}))i.call(t,a)&&s(e,a,t[a]);if(r)for(var a of r(t))l.call(t,a)&&s(e,a,t[a]);return e},o=(e,r)=>t(e,a(r));import{c as m,a as c,b as _,d,e as u,r as h,j as p,u as g,f as b,_ as f,F,g as v,h as y,R as x,i as N,P as k}from"./vendor.6197a69e.js";const C=(e,t)=>Math.floor(Math.random()*(t-e)+e),I=async(e,t)=>new Promise(((a,r)=>{setTimeout((()=>{e&&a(e()),t&&r(t())}),C(300,1e3))})),S=()=>{const e={},t=["url","variable","test","date","title","buddy","hey","xsolla"],a=C(1,t.length),r=()=>{Object.keys(e).length<a&&(e[t[C(0,t.length)]]={structure:"scalar",type:"string"},r())};return r(),e},E=async e=>I(S),P=()=>({id:C(1,1e4)}),T=async e=>I(P),w=async e=>I(P),O=async e=>I(P),A=m("MainForm/postData",(async e=>{const t=await E(e);return console.groupCollapsed("Запрос /data"),console.log("params:",JSON.stringify(e)),console.log("resoinse:",JSON.stringify(t)),console.groupEnd(),t})),D=m("MainForm/createLetter",(async e=>{const t=await T(e);return console.groupCollapsed("Запрос /createLetter"),console.log("params:",JSON.stringify(e)),console.log("resoinse:",JSON.stringify(t)),console.groupEnd(),t})),V=m("MainForm/createChatMessage",(async e=>{const t=await w(e);return console.groupCollapsed("Запрос /createChatMessage"),console.log("params:",JSON.stringify(e)),console.log("resoinse:",JSON.stringify(t)),console.groupEnd(),t})),j=m("MainForm/createTicket",(async e=>{const t=await O(e);return console.groupCollapsed("Запрос /createTicket"),console.log("params:",JSON.stringify(e)),console.log("resoinse:",JSON.stringify(t)),console.groupEnd(),t}));const M=d({reducer:_({mainForm:c({name:"MainForm",initialState:{Variables:null,CreationPayload:null},reducers:{},extraReducers:e=>{e.addCase(A.fulfilled,((e,t)=>{e.Variables=t.payload})),e.addCase(D.fulfilled,((e,t)=>{e.CreationPayload={type:"letter",id:t.payload.id,timestamp:(new Date).toDateString()}})),e.addCase(V.fulfilled,((e,t)=>{e.CreationPayload={type:"chat_message",id:t.payload.id,timestamp:(new Date).toDateString()}})),e.addCase(j.fulfilled,((e,t)=>{e.CreationPayload={type:"ticket",id:t.payload.id,timestamp:(new Date).toDateString()}}))}}).reducer}),devTools:!1}),q=u((e=>e.mainForm.Variables),(e=>e)),H=u(q,(e=>Object.keys(null!=e?e:{}))),L=u((e=>e.mainForm.CreationPayload),(e=>e)),W=h.exports.createContext([void 0,()=>{},void 0,()=>{}]),$=({children:e})=>{const[t,a]=h.exports.useState(),[r,i]=h.exports.useState(),l=h.exports.useCallback((e=>{a(e),i(void 0)}),[]),s=h.exports.useCallback((e=>{i(e),a(void 0)}),[]);return p(W.Provider,{value:[t,l,r,s],children:e})},K=e=>{const{handleDataPost:t}=e,{handleDataFieldsSetted:a}=e,r=g((e=>{const r=e.target;r.value&&r.checkValidity()?(t(r.value),a()):r.reportValidity()}),250);return b("fieldset",{className:"mainForm__fieldset",children:[p("div",{className:"mainForm__fieldset__legend",children:"Data"}),p("div",{className:"mainForm__fieldset__inputs",children:b("div",{className:"mainForm__formItem",children:[p("label",{className:"mainForm__formItem__label",htmlFor:"dwh_link",children:"DWH Link"}),p("input",{className:"mainForm__formItem__input",id:"dwh_link",name:"dwh_link",type:"url",onInput:r,placeholder:"https://service.xsolla.com",required:!0})]})}),p("div",{className:"mainForm__fieldset__extra"})]})},R=e=>{const{IsTriggerUnlocked:t}=e,{handleTriggerFieldsSetted:a}=e,r=h.exports.useCallback((e=>{const t=e.split(":");return-1*(60*Number(t[0])+Number(t[1]))}),[]),i=h.exports.useCallback((()=>{a()}),[]);return b("fieldset",{className:"mainForm__fieldset",children:[p("div",{className:"mainForm__fieldset__legend",children:"Trigger"}),b("div",{className:"mainForm__fieldset__inputs mainForm__fieldset__inputs--two",children:[b("div",{className:"mainForm__formItem mainForm__formItem__noTopMargin",children:[p("label",{className:"mainForm__formItem__label",htmlFor:"cron_exp",children:"CRON expression"}),p("input",{className:"mainForm__formItem__input",id:"cron_exp",name:"cron_exp",type:"text",placeholder:"0 */15 * ? * *",disabled:!t,onChange:i,required:!0})]}),b("div",{className:"mainForm__formItem mainForm__formItem__noTopMargin",children:[p("label",{className:"mainForm__formItem__label",htmlFor:"timezone",children:"Time zone"}),p("select",{className:"mainForm__formItem__input",id:"timezone",name:"timezone",disabled:!t,required:!0,children:f.map((e=>p("option",{value:r(e.utc),children:e.label},e.tzCode)))})]})]}),p("div",{className:"mainForm__fieldset__extra"})]})},J=e=>{const{inputProps:t,inputClassName:a}=e,{inputOnChange:r,inputOnFocus:i}=e,{hightlightArray:l}=e,[s,o]=h.exports.useState(""),[m,c]=h.exports.useContext(W),[_,d]=h.exports.useState(!1),u=h.exports.useRef(document.createElement("input"));h.exports.useEffect((()=>{var e,t;d((null==(e=null==m?void 0:m.current)?void 0:e.id)===(null==(t=null==u?void 0:u.current)?void 0:t.id))}),[m]),h.exports.useEffect((()=>{const e=e=>{const t=e.target;g(t.value)};_?u.current.addEventListener("change",e):u.current.removeEventListener("change",e)}),[_]);const g=h.exports.useCallback((e=>{let t=e;l.forEach((e=>{t=t.replace(/\n$/g,"\n\n"),t=t.replaceAll(`{{ ${e} }}`,`<mark>{{ ${e} }}</mark>`)})),o(t)}),[l]),f=h.exports.useCallback((e=>{r&&r(e),g(e.target.value)}),[r,g]),F=h.exports.useCallback((e=>{i&&i(e),c(u)}),[i,c]);return b("div",{className:"mainForm__inputWithHightlight mainForm__inputWithHightlight--textInput",children:[p("div",{className:"mainForm__inputWithHightlight__highlights",children:p("div",{className:"mainForm__inputWithHightlight__highlights__textBox",dangerouslySetInnerHTML:{__html:s}})}),p("input",n({ref:u,className:`mainForm__inputWithHightlight__input ${a}`,onChange:f,onFocus:F},t))]})},z=e=>{const{textareaProps:t,textareaClassName:a}=e,{textareaOnScroll:r,textareaOnChange:i,textareaOnFocus:l}=e,{hightlightArray:s}=e,[o,m]=h.exports.useState(""),[,,c,_]=h.exports.useContext(W),[d,u]=h.exports.useState(!1),g=h.exports.useRef(document.createElement("textarea")),f=h.exports.useRef(document.createElement("div"));h.exports.useEffect((()=>{var e,t;u((null==(e=null==c?void 0:c.current)?void 0:e.id)===(null==(t=null==g?void 0:g.current)?void 0:t.id))}),[c]),h.exports.useEffect((()=>()=>{_(void 0)}),[]),h.exports.useEffect((()=>{const e=e=>{const t=e.target;F(t.value)};d?g.current.addEventListener("change",e):g.current.removeEventListener("change",e)}),[d]);const F=h.exports.useCallback((e=>{let t=e;s.forEach((e=>{t=t.replace(/\n$/g,"\n\n"),t=t.replaceAll(`{{ ${e} }}`,`<mark>{{ ${e} }}</mark>`)})),m(t)}),[s]),v=h.exports.useCallback((e=>{i&&i(e),F(e.target.value)}),[i,F]),y=h.exports.useCallback((e=>{r&&r(e);const t=e.currentTarget.scrollTop;f.current.scrollTop=t}),[r]),x=h.exports.useCallback((e=>{l&&l(e),_(g)}),[l,_]);return b("div",{className:"mainForm__inputWithHightlight mainForm__inputWithHightlight--textarea",children:[p("div",{ref:f,className:"mainForm__inputWithHightlight__highlights",children:p("div",{className:"mainForm__inputWithHightlight__highlights__textBox",dangerouslySetInnerHTML:{__html:o}})}),p("textarea",n({ref:g,className:`mainForm__inputWithHightlight__input ${a}`,onChange:v,onScroll:y,onFocus:x},t))]})},U=e=>{const{VariablesKeys:t}=e;return b(F,{children:[b("div",{className:"mainForm__formItem",children:[p("label",{className:"mainForm__formItem__label",htmlFor:"letter_from",children:"From"}),p(J,{inputClassName:"mainForm__formItem__input",inputProps:{id:"letter_from",name:"letter_from",required:!0},hightlightArray:t})]}),b("div",{className:"mainForm__formItem",children:[p("label",{className:"mainForm__formItem__label",htmlFor:"letter_to",children:"To"}),p(J,{inputClassName:"mainForm__formItem__input",inputProps:{id:"letter_to",name:"letter_to",required:!0},hightlightArray:t})]}),b("div",{className:"mainForm__formItem",children:[p("label",{className:"mainForm__formItem__label",htmlFor:"letter_subject",children:"Subject"}),p(J,{inputClassName:"mainForm__formItem__input",inputProps:{id:"letter_subject",name:"letter_subject",required:!0},hightlightArray:t})]}),b("div",{className:"mainForm__formItem",children:[p("label",{className:"mainForm__formItem__label",htmlFor:"letter_text",children:"Text"}),p(z,{textareaClassName:"mainForm__formItem__input mainForm__formItem__input--textarea",textareaProps:{id:"letter_text",name:"letter_text",required:!0},hightlightArray:t})]})]})},B=e=>{const{VariablesKeys:t}=e;return b(F,{children:[b("div",{className:"mainForm__formItem",children:[p("label",{className:"mainForm__formItem__label",htmlFor:"chat_webhook_url",children:"Webhook URL"}),p(J,{inputClassName:"mainForm__formItem__input",inputProps:{id:"chat_webhook_url",name:"chat_webhook_url",required:!0},hightlightArray:t})]}),b("div",{className:"mainForm__formItem",children:[p("label",{className:"mainForm__formItem__label",htmlFor:"chat_text",children:"Text"}),p(z,{textareaClassName:"mainForm__formItem__input mainForm__formItem__input--textarea",textareaProps:{id:"chat_text",name:"chat_text",required:!0},hightlightArray:t})]})]})},G=e=>{const{VariablesKeys:t}=e;return b(F,{children:[b("div",{className:"mainForm__formItem",children:[p("label",{className:"mainForm__formItem__label",htmlFor:"ticket_summary",children:"Summary"}),p(J,{inputClassName:"mainForm__formItem__input",inputProps:{id:"ticket_summary",name:"ticket_summary",required:!0},hightlightArray:t})]}),b("div",{className:"mainForm__formItem",children:[p("label",{className:"mainForm__formItem__label",htmlFor:"ticket_description",children:"Description"}),p(J,{inputClassName:"mainForm__formItem__input",inputProps:{id:"ticket_description",name:"ticket_description",required:!0},hightlightArray:t})]}),b("div",{className:"mainForm__formItem",children:[p("label",{className:"mainForm__formItem__label",htmlFor:"ticket_assignee",children:"Assignee"}),p(J,{inputClassName:"mainForm__formItem__input",inputProps:{id:"ticket_assignee",name:"ticket_assignee",required:!0},hightlightArray:t})]}),b("div",{className:"mainForm__formItem",children:[p("label",{className:"mainForm__formItem__label",htmlFor:"ticket_reporter",children:"Reporter"}),p(J,{inputClassName:"mainForm__formItem__input",inputProps:{id:"ticket_reporter",name:"ticket_reporter",required:!0},hightlightArray:t})]})]})},Q=e=>{const{Variables:t,VariablesKeys:a}=e,{IsActivityUnlocked:r}=e,{SelectedActivityType:i,selectedActivityTypeChange:l}=e,[s,,n]=h.exports.useContext(W),o=h.exports.useCallback((e=>{const t=document.createEvent("HTMLEvents");t.initEvent("change",!1,!0),s&&(s.current.value+=`{{ ${e} }}`,s.current.dispatchEvent(t)),n&&(n.current.value+=`{{ ${e} }}`,n.current.dispatchEvent(t))}),[s,n]),m=h.exports.useMemo((()=>!!s||!!n),[s,n]);return b("fieldset",{className:"mainForm__fieldset",children:[p("div",{className:"mainForm__fieldset__legend",children:"Activity"}),b("div",{className:"mainForm__fieldset__inputs",children:[b("div",{className:"mainForm__formItem",children:[p("label",{className:"mainForm__formItem__label",htmlFor:"activity_type",children:"Type"}),b("select",{className:"mainForm__formItem__input",id:"activity_type",name:"activity_type",value:i,onChange:e=>l(e.currentTarget.value),disabled:!r,required:!0,children:[p("option",{disabled:!0,hidden:!0,value:"none"}),p("option",{value:"letter",children:"Letter"}),p("option",{value:"chat_message",children:"Chat Message"}),p("option",{value:"ticket",children:"Ticket"})]})]}),"letter"===i?p(U,{VariablesKeys:a}):null,"chat_message"===i?p(B,{VariablesKeys:a}):null,"ticket"===i?p(G,{VariablesKeys:a}):null]}),p("section",{className:"mainForm__fieldset__extra mainForm__variables",children:t?b(F,{children:[p("h4",{className:"mainForm__variables__title",children:"Variables"}),p("ul",{className:"mainForm__variables__list",children:Object.entries(t).map((e=>p("li",{className:"mainForm__variables__listItem",children:p("button",{type:"button",className:"mainForm__variables__button",onClick:t=>{t.preventDefault(),o(e[0])},disabled:!m,children:e[0]})},e[0])))})]}):null})]})};const X=e=>{const{Variables:t,VariablesKeys:a}=e,{handleDataPost:r}=e,{handleFormEntriesSubmit:i}=e,[l,s]=h.exports.useState(!1),[n,o]=h.exports.useState(!1),[m,c]=h.exports.useState("none"),_=h.exports.useCallback((e=>{e.preventDefault();const t=new FormData(e.target),a=Object.fromEntries(t);if("none"===a.activity_type)return alert("No activity type selected");i(a)}),[i]),d=h.exports.useCallback((e=>{c(e)}),[]),u=h.exports.useCallback((()=>{s(!0)}),[]),g=h.exports.useCallback((()=>{o(!0)}),[]);return b("form",{className:"mainForm",onSubmit:_,children:[p(K,{handleDataPost:r,handleDataFieldsSetted:u}),p("hr",{className:"mainForm__separator"}),p(R,{IsTriggerUnlocked:l,handleTriggerFieldsSetted:g}),p("hr",{className:"mainForm__separator"}),p($,{children:p(Q,{Variables:t,VariablesKeys:a,IsActivityUnlocked:n,SelectedActivityType:m,selectedActivityTypeChange:d})}),"none"!==m&&n?b("div",{className:"mainForm__buttons",children:[p("div",{children:p("button",{type:"submit",children:"Create"})}),p("div",{children:p("button",{type:"reset",children:"Reset"})})]}):null]})},Y=()=>{const e=v(q),t=v(H),a=v(L),r=y();h.exports.useEffect((()=>{if(a){let e="";switch(a.type){case"letter":e="Letter";break;case"chat_message":e="Chat Message";break;case"ticket":e="Ticket"}alert(`Activity "${e}" has been successfully created (ID: ${a.id})`)}}),[a]);const i=h.exports.useCallback((e=>{r(A({dwh_link:e}))}),[r]),l=h.exports.useCallback((e=>{const t={dwh_link:e.dwh_link,cron_exp:e.cron_exp,timezone:e.timezone};switch(e.activity_type){case"letter":r(D(o(n({},t),{data:{letter_from:e.letter_from,letter_to:e.letter_to,letter_subject:e.letter_subject,letter_text:e.letter_text}})));break;case"chat_message":r(V(o(n({},t),{data:{chat_webhook_url:e.chat_webhook_url,chat_text:e.chat_text}})));break;case"ticket":r(j(o(n({},t),{data:{ticket_summary:e.ticket_summary,ticket_description:e.ticket_description,ticket_assignee:e.ticket_assignee,ticket_reporter:e.ticket_reporter}})))}}),[r]);return p(X,{Variables:e,VariablesKeys:t,handleDataPost:i,handleFormEntriesSubmit:l})};const Z=()=>b("div",{className:"app",children:[p("header",{className:"app__header",children:p("h1",{children:"¯\\_(ツ)_/¯"})}),b("main",{className:"app__content",children:[p("div",{className:"app__content__wrapper",children:p(Y,{})}),b("div",{className:"app__content__link",children:["github:"," ",p("a",{href:"https://github.com/e965/xsolla-test-task",target:"_blank",children:"e965/xsolla-test-task"})]})]})]});x.render(p(N.StrictMode,{children:p(k,{store:M,children:p(Z,{})})}),document.getElementById("root"));
