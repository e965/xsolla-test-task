var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,s=(t,r,a)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a,l=(e,t)=>{for(var r in t||(t={}))i.call(t,r)&&s(e,r,t[r]);if(a)for(var r of a(t))n.call(t,r)&&s(e,r,t[r]);return e},o=(e,a)=>t(e,r(a));import{c as m,a as c,b as d,d as u,e as _,r as p,j as h,u as g,f,_ as b,s as y,F,g as v,h as I,i as x,R as N,k as C,P as k}from"./vendor.7f1b8797.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const S=(e,t)=>Math.floor(Math.random()*(t-e)+e),P=async(e,t)=>new Promise(((r,a)=>{setTimeout((()=>{e&&r(e()),t&&a(t())}),S(300,1e3))})),E=()=>{const e={},t=["url","variable","test","date","title","buddy","hey","xsolla"],r=S(1,t.length),a=()=>{Object.keys(e).length<r&&(e[t[S(0,t.length)]]={structure:"scalar",type:"string"},a())};return a(),e},T=async e=>P(E),D=()=>({id:S(0,1e3)}),O=async e=>P(D),A=async e=>P(D),V=async e=>P(D),w=m("MainForm/postData",(async e=>{const t=await T(e);return console.groupCollapsed("Запрос /data"),console.log("params:",JSON.stringify(e)),console.log("response:",JSON.stringify(t)),console.groupEnd(),t})),j=m("MainForm/insertInstruction",(async e=>{const t=await O(e.params);return console.groupCollapsed("Запрос /insert/instruction"),console.log("params:",JSON.stringify(e.params)),console.log("formData:",JSON.stringify(e.formData)),console.log("response:",JSON.stringify(t)),console.groupEnd(),{response:t,formData:e.formData}})),M=m("MainForm/insertActivity",(async e=>{const t=await A(e);return console.groupCollapsed("Запрос /insert/activity"),console.log("params:",JSON.stringify(e)),console.log("response:",JSON.stringify(t)),console.groupEnd(),t})),R=m("MainForm/insertTrigger",(async e=>{const t=await V(e);return console.groupCollapsed("Запрос /insert/trigger"),console.log("params:",JSON.stringify(e)),console.log("response:",JSON.stringify(t)),console.groupEnd(),t})),q=c({name:"MainForm",initialState:{Variables:null,InstructionInsertPayload:null,ActivityInsertPayload:null,TriggerInsertPayload:null,SubmitedFormData:null,IsFormSubmitPending:!1},reducers:{resetReduxState:(e,t)=>{e.Variables=null,e.InstructionInsertPayload=null,e.ActivityInsertPayload=null,e.TriggerInsertPayload=null,e.SubmitedFormData=null,e.IsFormSubmitPending=!1},resetQueryPayloads:(e,t)=>{e.InstructionInsertPayload=null,e.ActivityInsertPayload=null,e.TriggerInsertPayload=null,e.SubmitedFormData=null,e.IsFormSubmitPending=!1}},extraReducers:e=>{e.addCase(w.fulfilled,((e,t)=>{e.Variables=t.payload})),e.addCase(j.pending,((e,t)=>{e.IsFormSubmitPending=!0})),e.addCase(j.fulfilled,((e,t)=>{e.InstructionInsertPayload=o(l({},t.payload.response),{timestamp:(new Date).toISOString()}),e.SubmitedFormData=t.payload.formData})),e.addCase(j.rejected,((e,t)=>{e.IsFormSubmitPending=!1,console.warn(t.error)})),e.addCase(M.fulfilled,((e,t)=>{e.ActivityInsertPayload=o(l({},t.payload),{timestamp:(new Date).toISOString()})})),e.addCase(M.rejected,((e,t)=>{e.IsFormSubmitPending=!1,console.warn(t.error)})),e.addCase(R.fulfilled,((e,t)=>{e.IsFormSubmitPending=!0,e.TriggerInsertPayload=o(l({},t.payload),{timestamp:(new Date).toISOString()})})),e.addCase(R.rejected,((e,t)=>{e.IsFormSubmitPending=!1,console.warn(t.error)}))}}),{resetReduxState:H,resetQueryPayloads:L}=q.actions;const W=u({reducer:d({mainForm:q.reducer}),devTools:!1}),K=_((e=>e.mainForm.Variables),(e=>e)),$=_(K,(e=>Object.keys(null!=e?e:{}))),J=_((e=>e.mainForm.InstructionInsertPayload),(e=>e)),z=_((e=>e.mainForm.ActivityInsertPayload),(e=>e)),U=_((e=>e.mainForm.TriggerInsertPayload),(e=>e)),B=_((e=>e.mainForm.SubmitedFormData),(e=>e)),Q=_((e=>e.mainForm.IsFormSubmitPending),(e=>e)),G=p.exports.createContext([void 0,()=>{}]),X=({children:e})=>{const t=p.exports.useState();return h(G.Provider,{value:t,children:e})},Y=e=>{const{handleDataPost:t}=e,{handleDataFieldsSetted:r}=e,a=g((e=>{const a=e.target;a.value&&a.checkValidity()?(t(a.value),r()):a.reportValidity()}),250);return f("fieldset",{className:"mainForm__fieldset",children:[h("div",{className:"mainForm__fieldset__legend",children:"Data"}),h("div",{className:"mainForm__fieldset__inputs",children:f("div",{className:"mainForm__formItem",children:[h("label",{className:"mainForm__formItem__label",htmlFor:"dwh_link",children:"DWH Link"}),h("input",{className:"mainForm__formItem__input",id:"dwh_link",name:"dwh_link",type:"url",onInput:a,placeholder:"https://service.xsolla.com",required:!0})]})}),h("div",{className:"mainForm__fieldset__extra"})]})},Z=e=>{const{IsTriggerUnlocked:t}=e,{handleTriggerFieldsSetted:r}=e,a=p.exports.useCallback((()=>{r()}),[]);return f("fieldset",{className:"mainForm__fieldset",children:[h("div",{className:"mainForm__fieldset__legend",children:"Trigger"}),f("div",{className:"mainForm__fieldset__inputs mainForm__fieldset__inputs--two",children:[f("div",{className:"mainForm__formItem mainForm__formItem__noTopMargin",children:[h("label",{className:"mainForm__formItem__label",htmlFor:"cron_exp",children:"CRON expression"}),h("input",{className:"mainForm__formItem__input",id:"cron_exp",name:"cron_exp",type:"text",placeholder:"0 */15 * ? * *",disabled:!t,onChange:a,required:!0})]}),f("div",{className:"mainForm__formItem mainForm__formItem__noTopMargin",children:[h("label",{className:"mainForm__formItem__label",htmlFor:"timezone",children:"Time zone"}),h("select",{className:"mainForm__formItem__input",id:"timezone",name:"timezone",disabled:!t,required:!0,children:b.map((e=>h("option",{value:e.tzCode,children:e.label},e.tzCode)))})]})]}),h("div",{className:"mainForm__fieldset__extra"})]})},ee=(e,t)=>{const r=document.createEvent("HTMLEvents");r.initEvent("change",!1,!0);const a=e.length+"{{  }}".length,i=t.getCursorPosition(),n=i+a;var s,l,o;t.focus(),t.setValue((s=t.getValue(),l=i,o=e,s.substring(0,l)+`{{ ${o} }}`+s.substring(l,s.length))),t.setCursorPosition(n),t.dispatchEvent(r)},te=(e,t,r)=>{let a=e;t.forEach((e=>{a=a.replace(/\n$/g,"\n\n"),a=a.replaceAll(`{{ ${e} }}`,y.exports.renderToString(p.exports.createElement("mark",null,`{{ ${e} }}`)))})),r(a)},re=e=>{const{inputProps:t,inputClassName:r}=e,{inputOnChange:a,inputOnFocus:i}=e,{hightlightArray:n}=e,[s,o]=p.exports.useState(""),[m,c]=p.exports.useContext(G),[d,u]=p.exports.useState(!1),_=p.exports.useRef(document.createElement("input"));p.exports.useEffect((()=>{var e;u((null==m?void 0:m.getCurrentID())===(null==(e=_.current)?void 0:e.id))}),[m]),p.exports.useEffect((()=>()=>{c(void 0)}),[]),p.exports.useEffect((()=>{const e=e=>{const t=e.target;g(t.value)};d?_.current.addEventListener("change",e):_.current.removeEventListener("change",e)}),[d]);const g=p.exports.useCallback((e=>te(e,n,o)),[n]),b=p.exports.useCallback((e=>{a&&a(e),g(e.target.value)}),[a,g]),y=p.exports.useCallback((e=>{i&&i(e),c({getCurrentID:()=>{var e;return null==(e=_.current)?void 0:e.id},pushVariable:e=>ee(e,{setValue:e=>_.current.value=e,getValue:()=>_.current.value,focus:()=>_.current.focus(),getCursorPosition:()=>{var e;return null!=(e=_.current.selectionEnd)?e:0},setCursorPosition:e=>_.current.setSelectionRange(e,e),dispatchEvent:e=>_.current.dispatchEvent(e)})})}),[i,c]);return f("div",{className:"mainForm__inputWithHightlight mainForm__inputWithHightlight--textInput",children:[h("div",{className:"mainForm__inputWithHightlight__highlights",children:h("div",{className:"mainForm__inputWithHightlight__highlights__textBox",dangerouslySetInnerHTML:{__html:s}})}),h("input",l({ref:_,className:`mainForm__inputWithHightlight__input ${r}`,onChange:b,onFocus:y},t))]})},ae=e=>{const{textareaProps:t,textareaClassName:r}=e,{textareaOnScroll:a,textareaOnChange:i,textareaOnFocus:n}=e,{hightlightArray:s}=e,[o,m]=p.exports.useState(""),[c,d]=p.exports.useContext(G),[u,_]=p.exports.useState(!1),g=p.exports.useRef(document.createElement("textarea")),b=p.exports.useRef(document.createElement("div"));p.exports.useEffect((()=>{var e;_((null==c?void 0:c.getCurrentID())===(null==(e=g.current)?void 0:e.id))}),[c]),p.exports.useEffect((()=>()=>{d(void 0)}),[]),p.exports.useEffect((()=>{const e=e=>{const t=e.target;y(t.value)};u?g.current.addEventListener("change",e):g.current.removeEventListener("change",e)}),[u]);const y=p.exports.useCallback((e=>te(e,s,m)),[s]),F=p.exports.useCallback((e=>{i&&i(e),y(e.target.value)}),[i,y]),v=p.exports.useCallback((e=>{a&&a(e);const t=e.currentTarget.scrollTop;b.current.scrollTop=t}),[a]),I=p.exports.useCallback((e=>{n&&n(e),d({getCurrentID:()=>{var e;return null==(e=g.current)?void 0:e.id},pushVariable:e=>ee(e,{setValue:e=>g.current.value=e,getValue:()=>g.current.value,focus:()=>g.current.focus(),getCursorPosition:()=>g.current.selectionEnd,setCursorPosition:e=>g.current.setSelectionRange(e,e),dispatchEvent:e=>g.current.dispatchEvent(e)})})}),[n,d]);return f("div",{className:"mainForm__inputWithHightlight mainForm__inputWithHightlight--textarea",children:[h("div",{ref:b,className:"mainForm__inputWithHightlight__highlights",children:h("div",{className:"mainForm__inputWithHightlight__highlights__textBox",dangerouslySetInnerHTML:{__html:o}})}),h("textarea",l({ref:g,className:`mainForm__inputWithHightlight__input ${r}`,onChange:F,onScroll:v,onFocus:I},t))]})},ie=e=>{const{VariablesKeys:t}=e;return f(F,{children:[f("div",{className:"mainForm__formItem",children:[h("label",{className:"mainForm__formItem__label",htmlFor:"letter_from",children:"From"}),h(re,{inputClassName:"mainForm__formItem__input",inputProps:{id:"letter_from",name:"letter_from",required:!0},hightlightArray:t})]}),f("div",{className:"mainForm__formItem",children:[h("label",{className:"mainForm__formItem__label",htmlFor:"letter_to",children:"To"}),h(re,{inputClassName:"mainForm__formItem__input",inputProps:{id:"letter_to",name:"letter_to",required:!0},hightlightArray:t})]}),f("div",{className:"mainForm__formItem",children:[h("label",{className:"mainForm__formItem__label",htmlFor:"letter_subject",children:"Subject"}),h(re,{inputClassName:"mainForm__formItem__input",inputProps:{id:"letter_subject",name:"letter_subject",required:!0},hightlightArray:t})]}),f("div",{className:"mainForm__formItem",children:[h("label",{className:"mainForm__formItem__label",htmlFor:"letter_text",children:"Text"}),h(ae,{textareaClassName:"mainForm__formItem__input mainForm__formItem__input--textarea",textareaProps:{id:"letter_text",name:"letter_text",required:!0},hightlightArray:t})]})]})},ne=e=>{const{VariablesKeys:t}=e;return f(F,{children:[f("div",{className:"mainForm__formItem",children:[h("label",{className:"mainForm__formItem__label",htmlFor:"chat_webhook_url",children:"Webhook URL"}),h(re,{inputClassName:"mainForm__formItem__input",inputProps:{id:"chat_webhook_url",name:"chat_webhook_url",required:!0},hightlightArray:t})]}),f("div",{className:"mainForm__formItem",children:[h("label",{className:"mainForm__formItem__label",htmlFor:"chat_text",children:"Text"}),h(ae,{textareaClassName:"mainForm__formItem__input mainForm__formItem__input--textarea",textareaProps:{id:"chat_text",name:"chat_text",required:!0},hightlightArray:t})]})]})},se=e=>{const{VariablesKeys:t}=e;return f(F,{children:[f("div",{className:"mainForm__formItem",children:[h("label",{className:"mainForm__formItem__label",htmlFor:"ticket_summary",children:"Summary"}),h(re,{inputClassName:"mainForm__formItem__input",inputProps:{id:"ticket_summary",name:"ticket_summary",required:!0},hightlightArray:t})]}),f("div",{className:"mainForm__formItem",children:[h("label",{className:"mainForm__formItem__label",htmlFor:"ticket_description",children:"Description"}),h(re,{inputClassName:"mainForm__formItem__input",inputProps:{id:"ticket_description",name:"ticket_description",required:!0},hightlightArray:t})]}),f("div",{className:"mainForm__formItem",children:[h("label",{className:"mainForm__formItem__label",htmlFor:"ticket_assignee",children:"Assignee"}),h(re,{inputClassName:"mainForm__formItem__input",inputProps:{id:"ticket_assignee",name:"ticket_assignee",required:!0},hightlightArray:t})]}),f("div",{className:"mainForm__formItem",children:[h("label",{className:"mainForm__formItem__label",htmlFor:"ticket_reporter",children:"Reporter"}),h(re,{inputClassName:"mainForm__formItem__input",inputProps:{id:"ticket_reporter",name:"ticket_reporter",required:!0},hightlightArray:t})]})]})},le=e=>{const{Variables:t,VariablesKeys:r}=e,{IsActivityUnlocked:a}=e,{SelectedActivityType:i,selectedActivityTypeChange:n}=e,[s]=p.exports.useContext(G),l=p.exports.useCallback((e=>{s&&s.pushVariable(e)}),[s]),o=p.exports.useMemo((()=>!!s),[s]);return f("fieldset",{className:"mainForm__fieldset",children:[h("div",{className:"mainForm__fieldset__legend",children:"Activity"}),f("div",{className:"mainForm__fieldset__inputs",children:[f("div",{className:"mainForm__formItem",children:[h("label",{className:"mainForm__formItem__label",htmlFor:"activity_type",children:"Type"}),f("select",{className:"mainForm__formItem__input",id:"activity_type",name:"activity_type",value:i,onChange:e=>n(e.currentTarget.value),disabled:!a,required:!0,children:[h("option",{disabled:!0,hidden:!0,value:"none"}),h("option",{value:"letter",children:"Letter"}),h("option",{value:"chat_message",children:"Chat Message"}),h("option",{value:"ticket",children:"Ticket"})]})]}),"letter"===i?h(ie,{VariablesKeys:r}):null,"chat_message"===i?h(ne,{VariablesKeys:r}):null,"ticket"===i?h(se,{VariablesKeys:r}):null]}),h("section",{className:"mainForm__fieldset__extra mainForm__variables",children:t?f(F,{children:[h("h4",{className:"mainForm__variables__title",children:"Variables"}),h("ul",{className:"mainForm__variables__list",children:Object.entries(t).map((e=>h("li",{className:"mainForm__variables__listItem",children:h("button",{type:"button",className:"mainForm__variables__button",onClick:t=>{t.preventDefault(),l(e[0])},disabled:!o,children:e[0]})},e[0])))})]}):null})]})};const oe=e=>{const{Variables:t,VariablesKeys:r,IsFormSubmitPending:a}=e,{handleDataPost:i}=e,{handleFormEntriesSubmit:n,handleFormReset:s}=e,[l,o]=p.exports.useState(!1),[m,c]=p.exports.useState(!1),[d,u]=p.exports.useState("none"),_=p.exports.useCallback((e=>{e.preventDefault();const t=new FormData(e.target),r=Object.fromEntries(t);if("none"===r.activity_type)return alert("No activity type selected");n(r)}),[n]),g=p.exports.useCallback((()=>{o(!1),c(!1),u("none"),s()}),[s]),b=p.exports.useCallback((e=>{u(e)}),[]),y=p.exports.useCallback((()=>{o(!0)}),[]),F=p.exports.useCallback((()=>{c(!0)}),[]);return f("form",{className:"mainForm",onSubmit:_,onReset:g,children:[h(Y,{handleDataPost:i,handleDataFieldsSetted:y}),h("hr",{className:"mainForm__separator"}),h(Z,{IsTriggerUnlocked:l,handleTriggerFieldsSetted:F}),h("hr",{className:"mainForm__separator"}),h(X,{children:h(le,{Variables:t,VariablesKeys:r,IsActivityUnlocked:m,SelectedActivityType:d,selectedActivityTypeChange:b})}),"none"!==d&&m?f("div",{className:"mainForm__buttons",children:[h("div",{children:h("button",{type:"submit",disabled:a,children:"Create"})}),h("div",{children:h("button",{type:"reset",disabled:a,children:"Reset"})})]}):null]})},me=()=>{const e=v(K),t=v($),r=v(J),a=v(z),i=v(U),n=v(B),s=v(Q),l=I();p.exports.useEffect((()=>{r&&l(M({instruction_id:r.id,integrator_id:322,priority:0}))}),[l,r]),p.exports.useEffect((()=>{a&&n&&l(R({type:0,activites_id:[a.id],value:`${n.cron_exp} ${n.timezone}`}))}),[l,a]),p.exports.useEffect((()=>{i&&(alert("Activity created!"),l(L()))}),[i]);const o=p.exports.useCallback((e=>{l(w({source:e}))}),[l]),m=p.exports.useCallback((e=>{let r="";const a=e=>{let r=e;return t.forEach((e=>{r=r.replaceAll(`{{ ${e} }}`,`{{ data.${e} }}`)})),r};switch(e.activity_type){case"letter":r={recipients:{content:{type:"text/html",value:"body"},to:{email:a(e.letter_from),name:"",substitutions:[{key:"body",value:""}]},from:{email:a(e.letter_to),name:""},subject:a(e.letter_subject),text:a(e.letter_text),is_multiple:!0}};break;case"chat_message":r={messages:{webhook:a(e.chat_webhook_url),message:{text:a(e.chat_text)}}};break;case"ticket":r={issues:{fields:{summary:a(e.ticket_summary),description:a(e.ticket_description),reporter:{accountId:a(e.ticket_reporter)},assignee:{accountId:a(e.ticket_assignee)}}}}}const i=x.stringify(r);l(j({params:{type:0,template:i},formData:e}))}),[l,t]),c=p.exports.useCallback((()=>{l(H())}),[l]);return h(oe,{Variables:e,VariablesKeys:t,IsFormSubmitPending:s,handleDataPost:o,handleFormEntriesSubmit:m,handleFormReset:c})};const ce=()=>f("div",{className:"app",children:[h("header",{className:"app__header",children:h("h1",{children:"¯\\_(ツ)_/¯"})}),f("main",{className:"app__content",children:[h("div",{className:"app__content__wrapper",children:h(me,{})}),f("div",{className:"app__content__link",children:["github:"," ",h("a",{href:"https://github.com/e965/xsolla-test-task",target:"_blank",children:"e965/xsolla-test-task"})]})]})]});N.render(h(C.StrictMode,{children:h(k,{store:W,children:h(ce,{})})}),document.getElementById("root"));
