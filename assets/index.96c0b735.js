var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,n=(t,r,a)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a,l=(e,t)=>{for(var r in t||(t={}))i.call(t,r)&&n(e,r,t[r]);if(a)for(var r of a(t))s.call(t,r)&&n(e,r,t[r]);return e},o=(e,a)=>t(e,r(a));import{c as m,a as c,b as _,d,e as u,r as h,j as p,u as g,f,_ as b,s as y,F,g as v,h as x,R as N,i as k,P as C}from"./vendor.7fb0dee5.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const I=(e,t)=>Math.floor(Math.random()*(t-e)+e),S=async(e,t)=>new Promise(((r,a)=>{setTimeout((()=>{e&&r(e()),t&&a(t())}),I(300,1e3))})),P=()=>{const e={},t=["url","variable","test","date","title","buddy","hey","xsolla"],r=I(1,t.length),a=()=>{Object.keys(e).length<r&&(e[t[I(0,t.length)]]={structure:"scalar",type:"string"},a())};return a(),e},E=async e=>S(P),T=()=>({id:I(1,1e4)}),V=async e=>S(T),w=async e=>S(T),O=async e=>S(T),D=m("MainForm/postData",(async e=>{const t=await E(e);return console.groupCollapsed("Запрос /data"),console.log("params:",JSON.stringify(e)),console.log("resoinse:",JSON.stringify(t)),console.groupEnd(),t})),A=m("MainForm/createLetter",(async e=>{const t=await V(e);return console.groupCollapsed("Запрос /createLetter"),console.log("params:",JSON.stringify(e)),console.log("resoinse:",JSON.stringify(t)),console.groupEnd(),t})),M=m("MainForm/createChatMessage",(async e=>{const t=await w(e);return console.groupCollapsed("Запрос /createChatMessage"),console.log("params:",JSON.stringify(e)),console.log("resoinse:",JSON.stringify(t)),console.groupEnd(),t})),j=m("MainForm/createTicket",(async e=>{const t=await O(e);return console.groupCollapsed("Запрос /createTicket"),console.log("params:",JSON.stringify(e)),console.log("resoinse:",JSON.stringify(t)),console.groupEnd(),t})),L=c({name:"MainForm",initialState:{Variables:null,CreationPayload:null},reducers:{resetReduxState:(e,t)=>{e.Variables=null,e.CreationPayload=null}},extraReducers:e=>{e.addCase(D.fulfilled,((e,t)=>{e.Variables=t.payload})),e.addCase(A.fulfilled,((e,t)=>{e.CreationPayload={type:"letter",id:t.payload.id,timestamp:(new Date).toDateString()}})),e.addCase(M.fulfilled,((e,t)=>{e.CreationPayload={type:"chat_message",id:t.payload.id,timestamp:(new Date).toDateString()}})),e.addCase(j.fulfilled,((e,t)=>{e.CreationPayload={type:"ticket",id:t.payload.id,timestamp:(new Date).toDateString()}}))}}),{resetReduxState:R}=L.actions;const q=d({reducer:_({mainForm:L.reducer}),devTools:!1}),H=u((e=>e.mainForm.Variables),(e=>e)),W=u(H,(e=>Object.keys(null!=e?e:{}))),K=u((e=>e.mainForm.CreationPayload),(e=>e)),J=h.exports.createContext([void 0,()=>{}]),$=({children:e})=>{const t=h.exports.useState();return p(J.Provider,{value:t,children:e})},z=e=>{const{handleDataPost:t}=e,{handleDataFieldsSetted:r}=e,a=g((e=>{const a=e.target;a.value&&a.checkValidity()?(t(a.value),r()):a.reportValidity()}),250);return f("fieldset",{className:"mainForm__fieldset",children:[p("div",{className:"mainForm__fieldset__legend",children:"Data"}),p("div",{className:"mainForm__fieldset__inputs",children:f("div",{className:"mainForm__formItem",children:[p("label",{className:"mainForm__formItem__label",htmlFor:"dwh_link",children:"DWH Link"}),p("input",{className:"mainForm__formItem__input",id:"dwh_link",name:"dwh_link",type:"url",onInput:a,placeholder:"https://service.xsolla.com",required:!0})]})}),p("div",{className:"mainForm__fieldset__extra"})]})},U=e=>{const{IsTriggerUnlocked:t}=e,{handleTriggerFieldsSetted:r}=e,a=h.exports.useCallback((e=>{const t=e.split(":");return-1*(60*Number(t[0])+Number(t[1]))}),[]),i=h.exports.useCallback((()=>{r()}),[]);return f("fieldset",{className:"mainForm__fieldset",children:[p("div",{className:"mainForm__fieldset__legend",children:"Trigger"}),f("div",{className:"mainForm__fieldset__inputs mainForm__fieldset__inputs--two",children:[f("div",{className:"mainForm__formItem mainForm__formItem__noTopMargin",children:[p("label",{className:"mainForm__formItem__label",htmlFor:"cron_exp",children:"CRON expression"}),p("input",{className:"mainForm__formItem__input",id:"cron_exp",name:"cron_exp",type:"text",placeholder:"0 */15 * ? * *",disabled:!t,onChange:i,required:!0})]}),f("div",{className:"mainForm__formItem mainForm__formItem__noTopMargin",children:[p("label",{className:"mainForm__formItem__label",htmlFor:"timezone",children:"Time zone"}),p("select",{className:"mainForm__formItem__input",id:"timezone",name:"timezone",disabled:!t,required:!0,children:b.map((e=>p("option",{value:a(e.utc),children:e.label},e.tzCode)))})]})]}),p("div",{className:"mainForm__fieldset__extra"})]})},B=(e,t)=>{const r=document.createEvent("HTMLEvents");r.initEvent("change",!1,!0);const a=e.length+"{{  }}".length,i=t.getCursorPosition(),s=i+a;var n,l,o;t.focus(),t.setValue((n=t.getValue(),l=i,o=e,n.substring(0,l)+`{{ ${o} }}`+n.substring(l,n.length))),t.setCursorPosition(s),t.dispatchEvent(r)},G=(e,t,r)=>{let a=e;t.forEach((e=>{a=a.replace(/\n$/g,"\n\n"),a=a.replaceAll(`{{ ${e} }}`,y.exports.renderToString(h.exports.createElement("mark",null,`{{ ${e} }}`)))})),r(a)},Q=e=>{const{inputProps:t,inputClassName:r}=e,{inputOnChange:a,inputOnFocus:i}=e,{hightlightArray:s}=e,[n,o]=h.exports.useState(""),[m,c]=h.exports.useContext(J),[_,d]=h.exports.useState(!1),u=h.exports.useRef(document.createElement("input"));h.exports.useEffect((()=>{var e;d((null==m?void 0:m.getCurrentID())===(null==(e=u.current)?void 0:e.id))}),[m]),h.exports.useEffect((()=>()=>{c(void 0)}),[]),h.exports.useEffect((()=>{const e=e=>{const t=e.target;g(t.value)};_?u.current.addEventListener("change",e):u.current.removeEventListener("change",e)}),[_]);const g=h.exports.useCallback((e=>G(e,s,o)),[s]),b=h.exports.useCallback((e=>{a&&a(e),g(e.target.value)}),[a,g]),y=h.exports.useCallback((e=>{i&&i(e),c({getCurrentID:()=>{var e;return null==(e=u.current)?void 0:e.id},pushVariable:e=>B(e,{setValue:e=>u.current.value=e,getValue:()=>u.current.value,focus:()=>u.current.focus(),getCursorPosition:()=>{var e;return null!=(e=u.current.selectionEnd)?e:0},setCursorPosition:e=>u.current.setSelectionRange(e,e),dispatchEvent:e=>u.current.dispatchEvent(e)})})}),[i,c]);return f("div",{className:"mainForm__inputWithHightlight mainForm__inputWithHightlight--textInput",children:[p("div",{className:"mainForm__inputWithHightlight__highlights",children:p("div",{className:"mainForm__inputWithHightlight__highlights__textBox",dangerouslySetInnerHTML:{__html:n}})}),p("input",l({ref:u,className:`mainForm__inputWithHightlight__input ${r}`,onChange:b,onFocus:y},t))]})},X=e=>{const{textareaProps:t,textareaClassName:r}=e,{textareaOnScroll:a,textareaOnChange:i,textareaOnFocus:s}=e,{hightlightArray:n}=e,[o,m]=h.exports.useState(""),[c,_]=h.exports.useContext(J),[d,u]=h.exports.useState(!1),g=h.exports.useRef(document.createElement("textarea")),b=h.exports.useRef(document.createElement("div"));h.exports.useEffect((()=>{var e;u((null==c?void 0:c.getCurrentID())===(null==(e=g.current)?void 0:e.id))}),[c]),h.exports.useEffect((()=>()=>{_(void 0)}),[]),h.exports.useEffect((()=>{const e=e=>{const t=e.target;y(t.value)};d?g.current.addEventListener("change",e):g.current.removeEventListener("change",e)}),[d]);const y=h.exports.useCallback((e=>G(e,n,m)),[n]),F=h.exports.useCallback((e=>{i&&i(e),y(e.target.value)}),[i,y]),v=h.exports.useCallback((e=>{a&&a(e);const t=e.currentTarget.scrollTop;b.current.scrollTop=t}),[a]),x=h.exports.useCallback((e=>{s&&s(e),_({getCurrentID:()=>{var e;return null==(e=g.current)?void 0:e.id},pushVariable:e=>B(e,{setValue:e=>g.current.value=e,getValue:()=>g.current.value,focus:()=>g.current.focus(),getCursorPosition:()=>g.current.selectionEnd,setCursorPosition:e=>g.current.setSelectionRange(e,e),dispatchEvent:e=>g.current.dispatchEvent(e)})})}),[s,_]);return f("div",{className:"mainForm__inputWithHightlight mainForm__inputWithHightlight--textarea",children:[p("div",{ref:b,className:"mainForm__inputWithHightlight__highlights",children:p("div",{className:"mainForm__inputWithHightlight__highlights__textBox",dangerouslySetInnerHTML:{__html:o}})}),p("textarea",l({ref:g,className:`mainForm__inputWithHightlight__input ${r}`,onChange:F,onScroll:v,onFocus:x},t))]})},Y=e=>{const{VariablesKeys:t}=e;return f(F,{children:[f("div",{className:"mainForm__formItem",children:[p("label",{className:"mainForm__formItem__label",htmlFor:"letter_from",children:"From"}),p(Q,{inputClassName:"mainForm__formItem__input",inputProps:{id:"letter_from",name:"letter_from",required:!0},hightlightArray:t})]}),f("div",{className:"mainForm__formItem",children:[p("label",{className:"mainForm__formItem__label",htmlFor:"letter_to",children:"To"}),p(Q,{inputClassName:"mainForm__formItem__input",inputProps:{id:"letter_to",name:"letter_to",required:!0},hightlightArray:t})]}),f("div",{className:"mainForm__formItem",children:[p("label",{className:"mainForm__formItem__label",htmlFor:"letter_subject",children:"Subject"}),p(Q,{inputClassName:"mainForm__formItem__input",inputProps:{id:"letter_subject",name:"letter_subject",required:!0},hightlightArray:t})]}),f("div",{className:"mainForm__formItem",children:[p("label",{className:"mainForm__formItem__label",htmlFor:"letter_text",children:"Text"}),p(X,{textareaClassName:"mainForm__formItem__input mainForm__formItem__input--textarea",textareaProps:{id:"letter_text",name:"letter_text",required:!0},hightlightArray:t})]})]})},Z=e=>{const{VariablesKeys:t}=e;return f(F,{children:[f("div",{className:"mainForm__formItem",children:[p("label",{className:"mainForm__formItem__label",htmlFor:"chat_webhook_url",children:"Webhook URL"}),p(Q,{inputClassName:"mainForm__formItem__input",inputProps:{id:"chat_webhook_url",name:"chat_webhook_url",required:!0},hightlightArray:t})]}),f("div",{className:"mainForm__formItem",children:[p("label",{className:"mainForm__formItem__label",htmlFor:"chat_text",children:"Text"}),p(X,{textareaClassName:"mainForm__formItem__input mainForm__formItem__input--textarea",textareaProps:{id:"chat_text",name:"chat_text",required:!0},hightlightArray:t})]})]})},ee=e=>{const{VariablesKeys:t}=e;return f(F,{children:[f("div",{className:"mainForm__formItem",children:[p("label",{className:"mainForm__formItem__label",htmlFor:"ticket_summary",children:"Summary"}),p(Q,{inputClassName:"mainForm__formItem__input",inputProps:{id:"ticket_summary",name:"ticket_summary",required:!0},hightlightArray:t})]}),f("div",{className:"mainForm__formItem",children:[p("label",{className:"mainForm__formItem__label",htmlFor:"ticket_description",children:"Description"}),p(Q,{inputClassName:"mainForm__formItem__input",inputProps:{id:"ticket_description",name:"ticket_description",required:!0},hightlightArray:t})]}),f("div",{className:"mainForm__formItem",children:[p("label",{className:"mainForm__formItem__label",htmlFor:"ticket_assignee",children:"Assignee"}),p(Q,{inputClassName:"mainForm__formItem__input",inputProps:{id:"ticket_assignee",name:"ticket_assignee",required:!0},hightlightArray:t})]}),f("div",{className:"mainForm__formItem",children:[p("label",{className:"mainForm__formItem__label",htmlFor:"ticket_reporter",children:"Reporter"}),p(Q,{inputClassName:"mainForm__formItem__input",inputProps:{id:"ticket_reporter",name:"ticket_reporter",required:!0},hightlightArray:t})]})]})},te=e=>{const{Variables:t,VariablesKeys:r}=e,{IsActivityUnlocked:a}=e,{SelectedActivityType:i,selectedActivityTypeChange:s}=e,[n]=h.exports.useContext(J),l=h.exports.useCallback((e=>{n&&n.pushVariable(e)}),[n]),o=h.exports.useMemo((()=>!!n),[n]);return f("fieldset",{className:"mainForm__fieldset",children:[p("div",{className:"mainForm__fieldset__legend",children:"Activity"}),f("div",{className:"mainForm__fieldset__inputs",children:[f("div",{className:"mainForm__formItem",children:[p("label",{className:"mainForm__formItem__label",htmlFor:"activity_type",children:"Type"}),f("select",{className:"mainForm__formItem__input",id:"activity_type",name:"activity_type",value:i,onChange:e=>s(e.currentTarget.value),disabled:!a,required:!0,children:[p("option",{disabled:!0,hidden:!0,value:"none"}),p("option",{value:"letter",children:"Letter"}),p("option",{value:"chat_message",children:"Chat Message"}),p("option",{value:"ticket",children:"Ticket"})]})]}),"letter"===i?p(Y,{VariablesKeys:r}):null,"chat_message"===i?p(Z,{VariablesKeys:r}):null,"ticket"===i?p(ee,{VariablesKeys:r}):null]}),p("section",{className:"mainForm__fieldset__extra mainForm__variables",children:t?f(F,{children:[p("h4",{className:"mainForm__variables__title",children:"Variables"}),p("ul",{className:"mainForm__variables__list",children:Object.entries(t).map((e=>p("li",{className:"mainForm__variables__listItem",children:p("button",{type:"button",className:"mainForm__variables__button",onClick:t=>{t.preventDefault(),l(e[0])},disabled:!o,children:e[0]})},e[0])))})]}):null})]})};const re=e=>{const{Variables:t,VariablesKeys:r}=e,{handleDataPost:a}=e,{handleFormEntriesSubmit:i,handleFormReset:s}=e,[n,l]=h.exports.useState(!1),[o,m]=h.exports.useState(!1),[c,_]=h.exports.useState("none"),d=h.exports.useCallback((e=>{e.preventDefault();const t=new FormData(e.target),r=Object.fromEntries(t);if("none"===r.activity_type)return alert("No activity type selected");i(r)}),[i]),u=h.exports.useCallback((()=>{l(!1),m(!1),_("none"),s()}),[s]),g=h.exports.useCallback((e=>{_(e)}),[]),b=h.exports.useCallback((()=>{l(!0)}),[]),y=h.exports.useCallback((()=>{m(!0)}),[]);return f("form",{className:"mainForm",onSubmit:d,onReset:u,children:[p(z,{handleDataPost:a,handleDataFieldsSetted:b}),p("hr",{className:"mainForm__separator"}),p(U,{IsTriggerUnlocked:n,handleTriggerFieldsSetted:y}),p("hr",{className:"mainForm__separator"}),p($,{children:p(te,{Variables:t,VariablesKeys:r,IsActivityUnlocked:o,SelectedActivityType:c,selectedActivityTypeChange:g})}),"none"!==c&&o?f("div",{className:"mainForm__buttons",children:[p("div",{children:p("button",{type:"submit",children:"Create"})}),p("div",{children:p("button",{type:"reset",children:"Reset"})})]}):null]})},ae=()=>{const e=v(H),t=v(W),r=v(K),a=x();h.exports.useEffect((()=>{if(r){let e="";switch(r.type){case"letter":e="Letter";break;case"chat_message":e="Chat Message";break;case"ticket":e="Ticket"}alert(`Activity "${e}" has been successfully created (ID: ${r.id})`)}}),[r]);const i=h.exports.useCallback((e=>{a(D({dwh_link:e}))}),[a]),s=h.exports.useCallback((e=>{const t={dwh_link:e.dwh_link,cron_exp:e.cron_exp,timezone:e.timezone};switch(e.activity_type){case"letter":a(A(o(l({},t),{data:{letter_from:e.letter_from,letter_to:e.letter_to,letter_subject:e.letter_subject,letter_text:e.letter_text}})));break;case"chat_message":a(M(o(l({},t),{data:{chat_webhook_url:e.chat_webhook_url,chat_text:e.chat_text}})));break;case"ticket":a(j(o(l({},t),{data:{ticket_summary:e.ticket_summary,ticket_description:e.ticket_description,ticket_assignee:e.ticket_assignee,ticket_reporter:e.ticket_reporter}})))}}),[a]),n=h.exports.useCallback((()=>{a(R())}),[a]);return p(re,{Variables:e,VariablesKeys:t,handleDataPost:i,handleFormEntriesSubmit:s,handleFormReset:n})};const ie=()=>f("div",{className:"app",children:[p("header",{className:"app__header",children:p("h1",{children:"¯\\_(ツ)_/¯"})}),f("main",{className:"app__content",children:[p("div",{className:"app__content__wrapper",children:p(ae,{})}),f("div",{className:"app__content__link",children:["github:"," ",p("a",{href:"https://github.com/e965/xsolla-test-task",target:"_blank",children:"e965/xsolla-test-task"})]})]})]});N.render(p(k.StrictMode,{children:p(C,{store:q,children:p(ie,{})})}),document.getElementById("root"));
